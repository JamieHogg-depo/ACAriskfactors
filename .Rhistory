global_obj$census %>%
group_by(ra_sa2) %>%
summarise(sd = range(PC1)[1])
global_obj$census %>%
group_by(ra_sa2) %>%
summarise(min = range(PC1)[1],
max = range(PC1)[2])
global_obj$census %>%
group_by(ra_sa2) %>%
summarise(min = range(PC1)[1],
max = range(PC1)[2]) %>%
mutate(r = max - min)
5.87/3.71
summary(glm(ra_sa2 == "Major Cities" ~ irsd_sa2, data = global_obj$census))
summary(glm(ra_sa2 == "Major Cities" ~ irsd_5c, data = global_obj$census))
summary(glm(ra_sa2 == "Major Cities" ~ ABS_irsd_decile_nation_complete, data = global_obj$census))
fit <- glm(ra_sa2 == "Major Cities" ~ ABS_irsd_decile_nation_complete, data = global_obj$census)
predict(fit, type = "response")
table(ifelse(predict(fit, type = "response") > 0.5, "Major Cities", "None"), global_obj$census$ra_sa2)
table(ifelse(predict(fit, type = "response") > 0.5, "Major Cities", "None"), ifelse(global_obj$census$ra_sa2 == "Major Cities", "Major Cities", "None"))
861/2221
fit <- glm(ra_sa2 == "Remote" ~ ABS_irsd_decile_nation_complete, data = global_obj$census)
table(ifelse(predict(fit, type = "response") > 0.5, "Remote", "None"), ifelse(global_obj$census$ra_sa2 == "Remote", "Remote", "None"))
summary(fit)
fit <- glm(ra_sa2 == "Remote" ~ PC1, data = global_obj$census)
table(ifelse(predict(fit, type = "response") > 0.5, "Remote", "None"), ifelse(global_obj$census$ra_sa2 == "Remote", "Remote", "None"))
fit <- glm(ra_sa2 == "Major Cities" ~ PC1, data = global_obj$census)
table(ifelse(predict(fit, type = "response") > 0.5, "Major Cities", "None"), ifelse(global_obj$census$ra_sa2 == "Major Cities", "Major Cities", "None"))
fit <- glm(ra_sa2 == "Remote" ~ PC1, data = global_obj$census)
1077/2221
fit <- glm(ra_sa2 != "Major Cities" ~ PC1, data = global_obj$census)
table(ifelse(predict(fit, type = "response") > 0.5, "Non MC", "None"), ifelse(global_obj$census$ra_sa2 != "Major Cities", "Non MC", "None"))
summsa2all %>%
ggplot(aes(y = mu_CV, x = ra_sa2))+
geom_violin()
summsa2all %>%
ggplot(aes(y = mu_CV, x = ra_sa2))+
geom_violin()+
facet_grid(.~model)
summsa2all %>%
ggplot(aes(y = mu_CV, x = ra_sa2))+
geom_violin()+
facet_wrap(.~model)
summsa2all %>%
ggplot(aes(y = log(mu_CV), x = ra_sa2))+
geom_violin()+
facet_wrap(.~model)
summsa2all %>%
ggplot(aes(y = mu_median, x = ra_sa2))+
geom_violin()+
facet_wrap(.~model)
summsa2all %>%
group_by(model, ra_sa2) %>%
summarise(min = min(mu_median),
max = max(mu_median))
summsa2all %>%
group_by(model, ra_sa2) %>%
summarise(min = min(mu_median),
max = max(mu_median)) %>%
mutate(r = max - min)
summsa2all %>%
group_by(model, ra_sa2) %>%
summarise(min = min(mu_median),
max = max(mu_median)) %>%
mutate(r = max - min) %>% view()
summsa2all %>%
group_by(model, ra_sa2) %>%
summarise(min = min(mu_median),
max = max(mu_median)) %>%
mutate(r = max - min) %>%
ggplot(aes(x = ra_sa2, y = r))+
geom_point()+
facet_grid(.~model)
summsa2all %>%
group_by(model, ra_sa2) %>%
summarise(min = min(mu_median),
max = max(mu_median)) %>%
mutate(r = max - min) %>%
ggplot(aes(y = ra_sa2, x = r))+
geom_point()+
facet_wrap(.~model)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol")
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(y = out, x = ra_sa2)) %>%
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(y = out, x = ra_sa2)) +
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(y = out, col = ra_sa2)) +
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(y = out, fill = ra_sa2)) +
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol") %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "activityleis",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "alcohol",
!is.na(out),
out %in% c("HH")) %>%
ggplot(aes(x = irsd_5c, fill = ra_sa2)) +
geom_bar()#+
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ra_sa2)) +
geom_bar()+
facet_grid(.~irsd_5c)
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(x = out, fill = ps_state)) +
geom_bar()
summsa2all %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(x = out, fill = as.factor(ps_state))) +
geom_bar()
summsa2all %>%
left_join(.,state_name_concor) %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(x = out, fill = as.factor(state_name))) +
geom_bar()
summsa2all %>%
left_join(.,state_name_concor) %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
geom_bar()
geom_bar()
?geom_bar()
summsa2all %>%
left_join(.,state_name_concor) %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
geom_bar(position = "fill")
source("src/ms.R")
lookup <- data.frame(rf = names(raw_est),
sha = c("exercise", "exercise", "alcohol",
"fruit", "obese", "overweight",
"smoking", "overweight"),
rf_full = c("Leisure physical activity",
"All physical activity",
"Alcohol",
"Diet",
"Obesity",
"Overweight",
"Current smoking",
"Risky waist circumference")
)
k <- 1
rf <- names(raw_est)[k]
rf_full <- lookup[k,]$rf_full
sha_vars = paste0("shaout_", lookup[lookup$rf == rf,]$sha, "_", c("estimate", "lower", "upper"))
message("Started ", k, ": ", rf)
# load data
modelled_est <- readRDS(file = paste0("data/summary_files/", rf, "_b1.rds"))
modelled_est_nb <- readRDS(file = paste0("data/summary_files/", rf, "_b0.rds"))
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor) %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(model == "smoking",
!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "")
modelled_est$summ$sa2
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "")
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")
# save object
jsave(filename = paste0("bar_lisastate_", rf ,".png"),
base_folder = paste0(base_folder, "/figures"),
square = T)
# save object
jsave(filename = paste0("bar_lisastate_", rf ,".png"),
base_folder = paste0(base_folder, "/figures"),
square = F)
for(k in 1:8){
rf <- names(raw_est)[k]
rf_full <- lookup[k,]$rf_full
sha_vars = paste0("shaout_", lookup[lookup$rf == rf,]$sha, "_", c("estimate", "lower", "upper"))
message("Started ", k, ": ", rf)
# load data
modelled_est <- readRDS(file = paste0("data/summary_files/", rf, "_b1.rds"))
modelled_est_nb <- readRDS(file = paste0("data/summary_files/", rf, "_b0.rds"))
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")
# save object
jsave(filename = paste0("bar_lisastate_", rf ,".png"),
base_folder = paste0(base_folder, "/figures"),
square = F)
## FINISH FOR LOOP #### --------------------------------------------------------
}
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")+
scale_fill_manual(values = c("red", "coral", "skyblue", "royalblue"),
breaks = c("HH", "H", "L", "LL"))+
# save object
jsave(filename = paste0("bar_lisastate_", rf ,".png"),
base_folder = paste0(base_folder, "/figures"),
square = F)
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")+
scale_fill_manual(values = c("red", "coral", "skyblue", "royalblue"),
breaks = c("HH", "H", "L", "LL"))
for(k in 1:8){
rf <- names(raw_est)[k]
rf_full <- lookup[k,]$rf_full
sha_vars = paste0("shaout_", lookup[lookup$rf == rf,]$sha, "_", c("estimate", "lower", "upper"))
message("Started ", k, ": ", rf)
# load data
modelled_est <- readRDS(file = paste0("data/summary_files/", rf, "_b1.rds"))
modelled_est$summ$sa2 %>%
left_join(.,state_name_concor, by = "ps_state") %>%
mutate(lisa = ifelse(or_EP > 0.9, "H",
ifelse(or_EP < 0.1, "L", NA)),
out = factor(ifelse(is.na(LISA) & !is.na(lisa),
lisa, as.character(LISA)),
levels = c("HH", "H", "L", "LL"))) %>%
filter(!is.na(out)) %>%
ggplot(aes(fill = out, y = as.factor(state_name))) +
theme_bw()+
geom_bar(position = "fill")+
labs(y = "",
x = "",
fill = "",
title = rf_full)+
theme(legend.position = "bottom")+
scale_fill_manual(values = c("red", "coral", "skyblue", "royalblue"),
breaks = c("HH", "H", "L", "LL"))
# save object
jsave(filename = paste0("bar_lisastate_", rf ,".png"),
base_folder = paste0(base_folder, "/figures"),
square = F)
}
source('src/ms.R')
summsa2all %>%
left_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326) %>%
st_write(., "data/summ_shape/summ_shape.shp")
rm(list = ls())
temp <- st_read("data/summ_shape/summ_shape.shp")
summsa2all %>%
left_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326)
source('src/ms.R')
dim(map_sa2)
2268 * 8
temp <- summsa2all %>%
full_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326)
temp %>% filter(model == "obesity") %>% ggplot()+geom_sf()
st_write(temp, "data/summ_shape/summ_shape.shp")
st_write(temp, "data/summ_shape/summ_shape.shp", append = F)
temp <- summsa2all %>%
dplyr::select(ps_area, mu_median, or_median, or_EP) %>%
full_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326)
st_write(temp, "data/summ_shape/summ_shape.shp", append = F)
source('src/ms.R')
temp <- summsa2all %>%
dplyr::select(ps_area, mu_median, or_median, or_EP) %>%
full_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326)
st_write(temp, "data/summ_shape/summ_shape.shp", append = F)
temp <- summsa2all %>%
dplyr::select(ps_area, model, mu_median, or_median, or_EP) %>%
full_join(.,map_sa2, by = "ps_area") %>%
st_as_sf() %>%
st_transform(4326)
st_write(temp, "data/summ_shape/summ_shape.shp", append = F)
